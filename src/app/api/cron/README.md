# وظائف Cron API

هذا الدليل يشرح كيفية إعداد وظائف Cron لتشغيل العمليات المجدولة في المنصة.

## تحديث مستويات العضوية

### الوصف
تقوم هذه الوظيفة بتحديث مستويات العضوية لجميع المستخدمين بناءً على عدد الإحالات النشطة. يتم تشغيلها مرة واحدة يوميًا.

### نقطة النهاية
```
POST /api/cron/update-membership-levels
```

### كيفية الإعداد

#### باستخدام خدمة Cron Job عبر الإنترنت (مثل cron-job.org)

1. قم بإنشاء حساب على [cron-job.org](https://cron-job.org) أو أي خدمة مشابهة
2. أضف وظيفة Cron جديدة
3. أدخل عنوان URL الخاص بنقطة النهاية: `https://yourdomain.com/api/cron/update-membership-levels`
4. اختر طريقة الطلب: `POST`
5. قم بتعيين الجدول الزمني: مرة واحدة يوميًا (على سبيل المثال، الساعة 00:00)
6. احفظ الإعدادات

#### باستخدام Vercel Cron Jobs (إذا كنت تستخدم Vercel)

1. قم بإنشاء ملف `vercel.json` في المجلد الجذر للمشروع
2. أضف التكوين التالي:

```json
{
  "crons": [
    {
      "path": "/api/cron/update-membership-levels",
      "schedule": "0 0 * * *"
    }
  ]
}
```

3. قم بنشر التطبيق على Vercel

#### باستخدام وظائف Cron التقليدية (على الخادم)

إذا كنت تستخدم خادمًا تقليديًا، يمكنك إعداد وظيفة Cron باستخدام الأمر التالي:

```bash
0 0 * * * curl -X POST https://yourdomain.com/api/cron/update-membership-levels
```

### الأمان (اختياري)

لتأمين نقطة النهاية، يمكنك إضافة مفتاح API:

1. قم بإنشاء متغير بيئة `CRON_API_KEY` مع قيمة عشوائية آمنة
2. قم بإلغاء التعليق على التعليمات البرمجية للتحقق من المفتاح في ملف `route.ts`
3. أضف المفتاح إلى عنوان URL عند استدعاء نقطة النهاية:

```
https://yourdomain.com/api/cron/update-membership-levels?key=YOUR_API_KEY
```

## مراقبة النتائج

يمكنك مراقبة نتائج تشغيل وظائف Cron من خلال:

1. سجلات الخادم
2. لوحة تحكم Vercel (إذا كنت تستخدم Vercel)
3. إنشاء نظام تسجيل مخصص لتتبع نتائج تشغيل وظائف Cron
